
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Generadores &mdash; Bioinformatics at COMAV 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="Bioinformatics at COMAV 0.1 documentation" href="../index.html" />
    <link rel="next" title="Módulos" href="modulos.html" />
    <link rel="prev" title="Leyendo y escribiendo ficheros" href="ficheros.html" /> 
  </head>
  <body>

<div class="body">
    <header>
        <h1><a href="index.html">Bioinformatics at COMAV</a></h1>
    </header>


    <nav class="horizontal_nav page_nav">
        <ul>
            <li><a href="index.html">Bioinformatics & genomics</a>
                <ul>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="people.html">People</a></li>
                    <li><a href="publications.html">Publications</a></li>
                    <li><a href="getting_here.html">Getting here</a></li>
<!--                    <li><a href="http://bioinf.comav.upv.es/notes/">Wiki</a></li>-->
               </ul>
            </li>
            <li><a href="software.html">Software</a>
                <ul>
                    <li><a href="https://github.com/bioinfcomav/">Bioinf COMAV</a></li>
                    <li><a href="https://github.com/JoseBlanca/">Jose Blanca</a></li>
                    <!--
                    <li><a href="/seq_crumbs/index.html">seq_crumbs</a></li>
                    <li><a href="/ngs_backbone/index.html">ngs_backbone</a></li>
                    <li><a href="/clean_reads/index.html">clean_reads</a></li>
                    <li><a href="/sff_extract/index.html">sff_extract</a></li>
                    <li><a href="/psubprocess/index.html">psubprocess</a></li>-->
               </ul>
            </li>
            <li><a href="courses.html">Courses</a>
                <ul>
                    <li><a href="courses/intro_bioinf/index.html">Bionformática básica</a></li>
                    <li><a href="courses/sequence_analysis/index.html">NGS sequence analysis</a></li>
                    <li><a href="courses/linux/index.html">Linux y Python</a></li>
                    <li><a href="courses/unix/index.html">Linux para Biologos</a></li>
               </ul>
        </ul>
    </nav>

    <main>
                
    
  <section id="generadores">
<h1>Generadores<a class="headerlink" href="#generadores" title="Permalink to this headline">¶</a></h1>
<p>Supongamos que tenemos un fichero con una lista de genes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rubisco</span>
<span class="n">ADH</span>
<span class="n">apelatala</span>
</pre></div>
</div>
<p>Ya sabemos como escribir una función que lea este fichero y devuelva una lista con las palabras:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">leer_palabras</span><span class="p">(</span><span class="n">fichero</span><span class="p">):</span>
    <span class="n">palabras</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">fichero</span><span class="p">):</span>
        <span class="n">palabras</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linea</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">palabras</span>

<span class="k">for</span> <span class="n">palabra</span> <span class="ow">in</span> <span class="n">palabras</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">palabra</span> <span class="c1">#o lo que tengamos que hacer con ella</span>
</pre></div>
</div>
<p>Esta función crea primero una lista de palabras vacías.
A continuación recorre el fichero y añade todas las palabras a la lista y cuando acaba devuelve la lista de palabras.</p>
<p>Este forma de programación es completamente correcta y ampliamente usada, pero Python dispone de una variante de las funciones que puede en muchas ocasiones simplificar este tipo de problemas, el generador.
El problema anterior resuelto con generadores sería:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">leer_palabras</span><span class="p">(</span><span class="n">fichero</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">fichero</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">linea</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="k">for</span> <span class="n">palabra</span> <span class="ow">in</span> <span class="n">palabras</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">palabra</span> <span class="c1">#o lo que tengamos que hacer con ella</span>
</pre></div>
</div>
<p>La primera diferencia que salta a la vista entre la solución con funciones y la solución con generadores es que la segunda tiene la mitad de líneas que la primera, por lo que resulta mucho más sencilla de entender.
La diferencia sintáctica entre una función y un generador estriba en que mientras en la función se utiliza <em>return</em> en el generador se utiliza <em>yield</em>.
En la función creábamos una lista y guardábamos todas las palabras en ella antes de devolverla.
En el generador las palabras se van devolviendo de una en una a medida que se leen.
En realidad cada vez que el bucle <em>for</em> requiere una nueva palabra se hace una llamada al generador que devuelve esa palabra.
En el caso del generador sólo hay una palabra en la memoria, nunca se encuentra la lista completa.
Esta es otra de las ventajas de los generadores, son muy eficientes por lo que respecta a la memoria.</p>
<p>Un generador es en realidad un tipo particular de una clase de objetos más amplia, los iteradores.
Existen otras formas de definir iteradores en Python que no vamos a estudiar en esta introducción y Python tiene muchas funciones predefinidas que en realidad son iteradores.
Por ejemplo, la función <em>open</em> que hemos utilizado en numerosas ocasiones para abrir ficheros de texto es en realidad un iterador que nos va devolviendo las líneas de una en una.
En Python 3.x se hace un uso todavía más común de los iteradores, muchas de las funciones que en Python 2.x devuelven listas, como <em>range</em>, en Python 3.x se han convertido en iteradores.</p>
<p>El comportamiento de los iteradores es en cierto modo similar al de una lista.
Cuando utilizamos un bucle <em>for</em> para recorrer todas las líneas de un fichero nos parece que estemos recorriendo la lista de líneas, cuando en realidad las líneas son generadas de una en una.
Siempre que no necesitemos tener todos los elementos de la lista en la memoria a la vez podemos hacer uno de los generadores y los iteradores simplificando, en muchas ocasiones, el código del programa y haciendo un uso más eficiente de la memoria.</p>
<p>En cualquier momento podemos transformar un iterador en una lista leyendo todos sus elementos en memoria.
Por ejemplo, si tenemos un iterador con secuencias podemos transformarlo en una lista fácilmente:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">secuencias</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">secuencias</span><span class="p">)</span>
</pre></div>
</div>
<p>Además si combinamos los iteradores con las herramientas de la programación funcional como <em>map</em>, <em>filter</em> y <em>reduce</em> podemos crear programas muy potentes de un modo muy sencillo.
Esta forma de <a class="reference external" href="http://docs.python.org/dev/howto/functional.html">programación funcional</a> es un paradigma alternativo a la programación estructurada que hemos visto en este curso y que se ajusta muy bien a una gran cantidad de problemas biológicos.</p>
<section id="convertir-iterador-en-lista">
<h2>Convertir iterador en lista<a class="headerlink" href="#convertir-iterador-en-lista" title="Permalink to this headline">¶</a></h2>
</section>
<section id="ejercicios">
<h2>Ejercicios<a class="headerlink" href="#ejercicios" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Escribir un programa que lea un fichero fasta de secuencias:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">seq1</span> <span class="n">una</span> <span class="n">secuencia</span>
<span class="n">ACGTAGTCTGAGTCGTAGTCTAGTCTGAGCTA</span>
<span class="n">ATGCTAGTCATGTCTATCGAGTCAGTCTGATGCGT</span>
<span class="o">&gt;</span><span class="n">seq2</span> <span class="n">otra</span> <span class="n">secuencia</span>
<span class="n">ATGCTAGTCTGAGTCGTATCGTAGTCTATCAT</span>
<span class="n">ATCGTAGTCGATGCTGATGCTATCTGAT</span>
<span class="o">&gt;</span><span class="n">seq3</span> <span class="n">la</span> <span class="n">ultima</span> <span class="n">secuencia</span>
<span class="n">ATCGTAGTCGTAGCGTAGTCGTAGTCTATCTGA</span>
<span class="n">AGTACGTATGGCTATCGTATGCTATGCAGT</span>
</pre></div>
</div>
<p>Pistas:</p>
<blockquote>
<div><ul class="simple">
<li><p>Para separar el nombre y la descripción se puede usar el método de <em>str</em> <em>split(’ ‘, 1)</em>.</p></li>
<li><p>Una secuencia se puede guardar en un diccionario con las claves: nombre, descripción y secuencia.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Crear una función que elimine las tres primeras bases de una secuencia y aplicarla a las secuencias leídas en el ejercicio anterior.</p></li>
</ol>
</section>
<section id="soluciones">
<h2>Soluciones<a class="headerlink" href="#soluciones" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Escribir un programa que lea un fichero fasta de secuencias:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="n">seq1</span> <span class="n">una</span> <span class="n">secuencia</span>
<span class="n">ACGTAGTCTGAGTCGTAGTCTAGTCTGAGCTA</span>
<span class="n">ATGCTAGTCATGTCTATCGAGTCAGTCTGATGCGT</span>
<span class="o">&gt;</span><span class="n">seq2</span> <span class="n">otra</span> <span class="n">secuencia</span>
<span class="n">ATGCTAGTCTGAGTCGTATCGTAGTCTATCAT</span>
<span class="n">ATCGTAGTCGATGCTGATGCTATCTGAT</span>
<span class="o">&gt;</span><span class="n">seq3</span> <span class="n">la</span> <span class="n">ultima</span> <span class="n">secuencia</span>
<span class="n">ATCGTAGTCGTAGCGTAGTCGTAGTCTATCTGA</span>
<span class="n">AGTACGTATGGCTATCGTATGCTATGCAGT</span>
</pre></div>
</div>
<p>Pistas:</p>
<blockquote>
<div><ul class="simple">
<li><p>Para separar el nombre y la descripción se puede usar el método de <em>str</em> <em>split(’ ‘, 1)</em>.</p></li>
<li><p>Una secuencia se puede guardar en un diccionario con las claves: nombre, descripción y secuencia.</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="k">def</span> <span class="nf">secuencias_en_fasta</span><span class="p">(</span><span class="n">fichero</span><span class="p">):</span>
    <span class="s1">&#39;Genera las secuencias de un fichero fasta&#39;</span>

    <span class="c1">#inicializamos las variables que contendra</span>
    <span class="c1">#la secuencia sumada de varias lineas</span>
    <span class="n">secuencia</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="c1">#y el nombre y la descripcion</span>
    <span class="n">nombre</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">descripcion</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1">#recorremos el fichero linea por linea</span>
    <span class="k">for</span> <span class="n">linea</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">fichero</span><span class="p">):</span>
        <span class="n">linea</span> <span class="o">=</span> <span class="n">linea</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>   <span class="c1">#quita el retorno de carro</span>

        <span class="c1">#una linea con nombre de secuencia</span>
        <span class="k">if</span> <span class="n">linea</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">):</span>
            <span class="c1">#si tenemos una secuencia en memoria</span>
            <span class="c1">#este es el momento de devolverla,</span>
            <span class="c1">#antes de pasar a procesar una nueva</span>
            <span class="c1">#secuencia</span>
            <span class="k">if</span> <span class="n">secuencia</span><span class="p">:</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;secuencia&#39;</span><span class="p">:</span> <span class="n">secuencia</span><span class="p">,</span>
                       <span class="s1">&#39;nombre&#39;</span><span class="p">:</span> <span class="n">nombre</span><span class="p">,</span>
                       <span class="s1">&#39;descripcion&#39;</span><span class="p">:</span> <span class="n">descripcion</span><span class="p">}</span>
                <span class="k">yield</span> <span class="n">seq</span>
            <span class="c1">#ahora procesamos la linea creando</span>
            <span class="c1">#el nuevo nombre y descripcion</span>
            <span class="n">nombre</span><span class="p">,</span> <span class="n">descripcion</span> <span class="o">=</span> <span class="n">linea</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">nombre</span> <span class="o">=</span> <span class="n">nombre</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1">#elimina el &#39;&gt;&#39;</span>
            <span class="c1">#la secuencia es &#39;&#39; porque todavia no</span>
            <span class="c1">#hemos leido ninguan linea con secuencia</span>
            <span class="n">secuencia</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1">#si la linea tiene secuencia hemos de anyadirla</span>
        <span class="c1">#a la secuencia que estamos leyendo</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">secuencia</span> <span class="o">+=</span> <span class="n">linea</span>

    <span class="c1">#cuando el bucle for acabe tendremos una secuencia</span>
    <span class="c1">#en memoria que no habremos devuelto.</span>
    <span class="k">if</span> <span class="n">secuencia</span><span class="p">:</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;secuencia&#39;</span><span class="p">:</span> <span class="n">secuencia</span><span class="p">,</span>
               <span class="s1">&#39;nombre&#39;</span><span class="p">:</span> <span class="n">nombre</span><span class="p">,</span>
               <span class="s1">&#39;descripcion&#39;</span><span class="p">:</span> <span class="n">descripcion</span><span class="p">}</span>
        <span class="k">yield</span> <span class="n">seq</span>


<span class="k">def</span> <span class="nf">read_fastas</span><span class="p">(</span><span class="n">fichero</span><span class="p">):</span>
    <span class="s1">&#39;Lee las secuencias fasta de un fichero&#39;</span>

    <span class="c1">#podemos leer todas las secuencias con un bucle for</span>
    <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">secuencias_en_fasta</span><span class="p">(</span><span class="n">fichero</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;nombre -&gt;&#39;</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">]</span>
        <span class="nb">print</span> <span class="s1">&#39;descripcion -&gt;&#39;</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="s1">&#39;descripcion&#39;</span><span class="p">]</span>
        <span class="nb">print</span> <span class="s1">&#39;secuencia -&gt;&#39;</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="s1">&#39;secuencia&#39;</span><span class="p">]</span>

    <span class="c1">#si queremos guardarlas en una lista</span>
    <span class="n">secuencias</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">secuencias_en_fasta</span><span class="p">(</span><span class="n">fichero</span><span class="p">))</span>
    <span class="nb">print</span> <span class="n">secuencias</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">read_fastas</span><span class="p">(</span><span class="s1">&#39;secuencias.fasta&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Crear una función que elimine las tres primeras bases de una secuencia y aplicarla a las secuencias leídas en el ejercicio anterior.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quitar_5_prima</span><span class="p">(</span><span class="n">secuencia</span><span class="p">):</span>
    <span class="s1">&#39;Elimina tres bases del 5 prima&#39;</span>
    <span class="c1">#esto se haria mejor con copy</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nombre&#39;</span><span class="p">:</span> <span class="n">secuencia</span><span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">],</span>
           <span class="s1">&#39;descripcion&#39;</span><span class="p">:</span> <span class="n">secuencia</span><span class="p">[</span><span class="s1">&#39;descripcion&#39;</span><span class="p">]}</span>

    <span class="n">seq</span><span class="p">[</span><span class="s1">&#39;secuencia&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">secuencia</span><span class="p">[</span><span class="s1">&#39;secuencia&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">seq</span>

<span class="k">def</span> <span class="nf">read_fastas</span><span class="p">(</span><span class="n">fichero</span><span class="p">):</span>
    <span class="s1">&#39;Lee las secuencias fasta de un fichero&#39;</span>

    <span class="c1">#podemos leer todas las secuencias con un bucle for</span>
    <span class="k">for</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">secuencias_en_fasta</span><span class="p">(</span><span class="n">fichero</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s1">&#39;secuencia antes -&gt;&#39;</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="s1">&#39;secuencia&#39;</span><span class="p">]</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="n">quitar_5_prima</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;secuencia despu -&gt;&#39;</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="s1">&#39;secuencia&#39;</span><span class="p">]</span>

    <span class="c1">#tambien se puede hacer con el iterador directamente</span>
    <span class="n">seqs</span> <span class="o">=</span> <span class="n">secuencias_en_fasta</span><span class="p">(</span><span class="n">fichero</span><span class="p">)</span>
    <span class="c1">#utilizando map</span>
    <span class="n">secuencias</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">quitar_5_prima</span><span class="p">,</span> <span class="n">seqs</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">secuencias</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">read_fastas</span><span class="p">(</span><span class="s1">&#39;secuencias.fasta&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>



        

    </main>

</div>
    <footer>
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/"><img alt="Licencia de Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br /><span xmlns:dct="https://purl.org/dc/terms/" property="dct:title">Bioinformatics at COMAV</span> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Reconocimiento 4.0 Internacional License</a>.
    </footer>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-16108274-1");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>